(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36c0028a"],{"3ed6":function(t,e,s){"use strict";s.r(e);s("57e7");var i=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},[e("div",{staticClass:"chatBox"},[e("div",{ref:"chat",staticClass:"message"},t._l(t.receiveNews,(function(s,i){return e("div",{key:i,staticClass:"messageItem",class:s.id==t.selfUserId?"self":"other"},[e("img",{directives:[{name:"show",rawName:"v-show",value:s.id==t.otherUserId,expression:"item.id == otherUserId"}],staticClass:"headIconRight",attrs:{src:t.selfHead}}),0==s.msgType?e("div",{staticClass:"text"},[t._v(t._s(s.msg))]):e("el-image",{staticClass:"imgMassage",attrs:{src:s.msg,"preview-src-list":[s.msg]}}),e("img",{directives:[{name:"show",rawName:"v-show",value:s.id==t.selfUserId,expression:"item.id == selfUserId"}],staticClass:"headIconLeft",attrs:{src:t.otherHead}})],1)})),0),e("el-input",{staticClass:"send_input",attrs:{id:"bottom",placeholder:"请输入内容"},on:{change:t.valueChange},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doPublish.apply(null,arguments)}},model:{value:t.inputVlaue,callback:function(e){t.inputVlaue=e},expression:"inputVlaue"}},[e("el-button",{attrs:{slot:"append",loading:t.sending},on:{click:t.doPublish},slot:"append"},[t._v("发送")])],1),e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"",accept:".jpg,.png,.gif","auto-upload":!1,"show-file-list":!1,"on-change":t.handleHeadImg}},[e("el-button",{staticClass:"button blue"},[t._v("发送图片")])],1)],1)])},o=[],n=s("15fd"),c=s("e7fc"),a=s.n(c),l=["host","port","endpoint"],r={data:function(){return{selfUserId:"111",selfHead:"https://img0.baidu.com/it/u=2409125767,2106097442&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400",otherHead:"https://img1.baidu.com/it/u=513917707,3330365276&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400",otherUserId:"222",connection:{host:"broker.emqx.io",port:8083,endpoint:"/mqtt",clean:!0,connectTimeout:4e3,reconnectPeriod:4e3,clientId:"mqttx_3937577c",username:"zisu1",password:"123123"},subscription:{topic:"topic/chat1",qos:0},inputVlaue:"",publish:{topic:"topic/chat",qos:1,payload:{msg:null,id:"111",msgType:0}},receiveNews:[],client:{connected:!1},subscribeSuccess:!1,sending:!1}},mounted:function(){this.client.connected||this.createConnection(),this.doSubscribe()},methods:{handleHeadImg:function(t){this.publish.payload.msgType=1,this.publish.payload.msg="https://img2.baidu.com/it/u=1814561676,2470063876&fm=253&fmt=auto&app=138&f=JPEG?w=750&h=500",this.doPublish()},valueChange:function(t){this.publish.payload.msgType=0,this.publish.payload.msg=t,console.log(this.publish)},createConnection:function(){var t=this,e=this.connection,s=e.host,i=e.port,o=e.endpoint,c=Object(n["a"])(e,l),r="ws://".concat(s,":").concat(i).concat(o);try{this.client=a.a.connect(r,c)}catch(u){console.log("mqtt.connect error",u)}this.client.on("connect",(function(){console.log("Connection succeeded!")})),this.client.on("error",(function(t){console.log("Connection failed",t)})),this.client.on("message",(function(e,s){var i="";i=i.concat(s),console.log(s),t.receiveNews.push(JSON.parse(i)),t.$nextTick((function(){var e=t.$refs.chat;e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}))}))},doSubscribe:function(){var t=this,e=this.subscription,s=e.topic,i=e.qos;this.client.subscribe(s,i,(function(e,s){e?console.log("Subscribe to topics error",e):(t.subscribeSuccess=!0,console.log("Subscribe to topics res",s))}))},doUnSubscribe:function(){var t=this.subscription.topic;this.client.unsubscribe(t,(function(t){t&&console.log("Unsubscribe error",t)}))},doPublish:function(){var t=this;this.sending=!0;var e={msg:this.publish.payload.msg,id:"111",msgType:this.publish.payload.msgType},s=this.publish,i=s.topic,o=s.qos,n=s.payload;this.client.publish(i,JSON.stringify(n),{qos:o,retain:!0},(function(s){t.sending=!1,s||(t.receiveNews.push(e),t.inputVlaue="",t.scrollToBottom())}))},scrollToBottom:function(){var t=this.$refs.chat;t.scrollTo({top:t.scrollHeight+2e3,behavior:"smooth"})}}},u=r,h=(s("4d88"),s("0c7c")),p=Object(h["a"])(u,i,o,!1,null,"f0ce9982",null);e["default"]=p.exports},"4d88":function(t,e,s){"use strict";s("f0c7")},f0c7:function(t,e,s){}}]);
//# sourceMappingURL=chunk-36c0028a.704c8286.js.map