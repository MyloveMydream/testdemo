{"version":3,"sources":["webpack:///./src/components/testPage/mqtt.vue","webpack:///src/components/testPage/mqtt.vue","webpack:///./src/components/testPage/mqtt.vue?78c8","webpack:///./src/components/testPage/mqtt.vue?3fb1","webpack:///./src/components/testPage/mqtt.vue?e06c"],"names":["render","_vm","this","_c","_self","staticStyle","staticClass","ref","_l","receiveNews","item","index","key","class","id","selfUserId","directives","name","rawName","value","otherUserId","expression","attrs","selfHead","msgType","_v","_s","msg","otherHead","on","valueChange","nativeOn","$event","type","indexOf","_k","keyCode","doPublish","apply","arguments","model","inputVlaue","callback","$$v","sending","slot","handleHeadImg","staticRenderFns","data","connection","host","port","endpoint","clean","connectTimeout","reconnectPeriod","clientId","username","password","subscription","topic","qos","publish","payload","client","connected","subscribeSuccess","mounted","createConnection","doSubscribe","methods","console","log","_this","_this$connection","options","_objectWithoutProperties","_excluded","connectUrl","concat","mqtt","connect","error","message","m","push","JSON","parse","$nextTick","scrollElem","$refs","chat","scrollTo","top","scrollHeight","behavior","_this2","_this$subscription","subscribe","res","doUnSubscribe","unsubscribe","_this3","obj","_this$publish","stringify","retain","scrollToBottom","component"],"mappings":"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","file":"js/chunk-36c0028a.f9ecb5fd.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticStyle:{\"display\":\"flex\",\"align-items\":\"center\",\"justify-content\":\"center\",\"height\":\"100%\"}},[_c('div',{staticClass:\"chatBox\"},[_c('div',{ref:\"chat\",staticClass:\"message\"},_vm._l((_vm.receiveNews),function(item,index){return _c('div',{key:index,staticClass:\"messageItem\",class:item.id == _vm.selfUserId ? 'self' : 'other'},[_c('img',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.id == _vm.otherUserId),expression:\"item.id == otherUserId\"}],staticClass:\"headIconRight\",attrs:{\"src\":_vm.selfHead}}),(item.msgType == 0)?_c('div',{staticClass:\"text\"},[_vm._v(_vm._s(item.msg))]):_c('el-image',{staticClass:\"imgMassage\",attrs:{\"src\":item.msg,\"preview-src-list\":[item.msg]}}),_c('img',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.id == _vm.selfUserId),expression:\"item.id == selfUserId\"}],staticClass:\"headIconLeft\",attrs:{\"src\":_vm.otherHead}})],1)}),0),_c('el-input',{staticClass:\"send_input\",attrs:{\"id\":\"bottom\",\"placeholder\":\"请输入内容\"},on:{\"change\":_vm.valueChange},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\"))return null;return _vm.doPublish.apply(null, arguments)}},model:{value:(_vm.inputVlaue),callback:function ($$v) {_vm.inputVlaue=$$v},expression:\"inputVlaue\"}},[_c('el-button',{attrs:{\"slot\":\"append\",\"loading\":_vm.sending},on:{\"click\":_vm.doPublish},slot:\"append\"},[_vm._v(\"发送\")])],1),_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":\"\",\"accept\":\".jpg,.png,.gif\",\"auto-upload\":false,\"show-file-list\":false,\"on-change\":_vm.handleHeadImg}},[_c('el-button',{staticClass:\"button blue\"},[_vm._v(\"发送图片\")])],1)],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div style=\"display: flex;align-items: center;justify-content: center; height: 100%\">\r\n    <div class=\"chatBox\">\r\n      <div class=\"message\" ref=\"chat\">\r\n        <div class=\"messageItem\" :class=\"item.id == selfUserId ? 'self' : 'other'\" v-for=\"(item,index) in receiveNews\"\r\n          :key=\"index\">\r\n          <img class=\"headIconRight\" :src=\"selfHead\" v-show=\"item.id == otherUserId\">\r\n          <div class=\"text\" v-if=\"item.msgType == 0\">{{ item.msg }}</div>\r\n          <el-image class=\"imgMassage\" v-else :src=\"item.msg\" :preview-src-list=\"[item.msg]\"></el-image>\r\n          <img class=\"headIconLeft\" :src=\"otherHead\" v-show=\"item.id == selfUserId\">\r\n        </div>\r\n      </div>\r\n      <el-input v-model=\"inputVlaue\" class=\"send_input\" id=\"bottom\" placeholder=\"请输入内容\" @change=\"valueChange\"\r\n        @keyup.enter.native=\"doPublish\">\r\n        <el-button slot=\"append\" @click=\"doPublish\" :loading=\"sending\">发送</el-button>\r\n      </el-input>\r\n      <el-upload action=\"\" accept=\".jpg,.png,.gif\" class=\"avatar-uploader\" :auto-upload=\"false\" :show-file-list=\"false\"\r\n        :on-change=\"handleHeadImg\">\r\n        <el-button class=\"button blue\">发送图片</el-button>\r\n      </el-upload>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import mqtt from 'mqtt'\r\n  import Vue from 'vue';\r\n  export default {\r\n    data() {\r\n      return {\r\n        selfUserId: \"111\",\r\n        selfHead: \"https://img0.baidu.com/it/u=2409125767,2106097442&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400\",\r\n        otherHead: \"https://img1.baidu.com/it/u=513917707,3330365276&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400\",\r\n        otherUserId: \"222\",\r\n        connection: {\r\n          host: 'broker.emqx.io',\r\n          port: 8083,\r\n          endpoint: '/mqtt',\r\n          clean: true, // 保留会话\r\n          connectTimeout: 4000, // 超时时间\r\n          reconnectPeriod: 4000, // 重连时间间隔\r\n          // 认证信息\r\n          clientId: 'mqttx_3937577c',\r\n          username: 'zisu1',\r\n          password: '123123',\r\n        },\r\n        subscription: {\r\n          topic: 'topic/chat1',\r\n          qos: 0,\r\n        },\r\n        inputVlaue: \"\",\r\n        publish: {\r\n          topic: 'topic/chat',\r\n          qos: 1,\r\n          payload: {\r\n            msg: null,\r\n            id: \"111\",\r\n            msgType: 0 // 0 文本  1 图片\r\n          },\r\n        },\r\n        receiveNews: [],\r\n        client: {\r\n          connected: false,\r\n        },\r\n        subscribeSuccess: false,\r\n        sending: false,\r\n      }\r\n    },\r\n    mounted() {\r\n      \r\n      if (!this.client.connected) {\r\n        this.createConnection();\r\n      }\r\n\r\n      this.doSubscribe();\r\n      \r\n    },\r\n    methods: {\r\n      handleHeadImg(value) {\r\n        this.publish.payload.msgType = 1;\r\n        // this.publish.payload.msg = \"http://minio.test.huiyin.tech/dev/731c85adf7fc43cd8836a4d1e4e7f3fc.png\";\r\n        this.publish.payload.msg =\r\n          \"https://img2.baidu.com/it/u=1814561676,2470063876&fm=253&fmt=auto&app=138&f=JPEG?w=750&h=500\";\r\n        this.doPublish();\r\n      },\r\n      valueChange(value) {\r\n        this.publish.payload.msgType = 0;\r\n        this.publish.payload.msg = value;\r\n        console.log(this.publish);\r\n      },\r\n      // 创建连接\r\n      createConnection() {\r\n        const {\r\n          host,\r\n          port,\r\n          endpoint,\r\n          ...options\r\n        } = this.connection\r\n        const connectUrl = `ws://${host}:${port}${endpoint}`\r\n        try {\r\n          this.client = mqtt.connect(connectUrl, options)\r\n        } catch (error) {\r\n          console.log('mqtt.connect error', error)\r\n        }\r\n        this.client.on('connect', () => {\r\n          console.log('Connection succeeded!')\r\n        })\r\n        this.client.on('error', error => {\r\n          console.log('Connection failed', error)\r\n        })\r\n        this.client.on('message', (topic, message) => {\r\n          let m = \"\";\r\n          m = m.concat(message)\r\n          console.log(message);\r\n          this.receiveNews.push(JSON.parse(m));\r\n          this.$nextTick(() => {\r\n            let scrollElem = this.$refs.chat;\r\n            scrollElem.scrollTo({\r\n              top: scrollElem.scrollHeight,\r\n              behavior: 'smooth'\r\n            });\r\n          });\r\n        })\r\n      },\r\n      doSubscribe() {\r\n        const {\r\n          topic,\r\n          qos\r\n        } = this.subscription\r\n        this.client.subscribe(topic, qos, (error, res) => {\r\n          if (error) {\r\n            console.log('Subscribe to topics error', error)\r\n            return\r\n          }\r\n          this.subscribeSuccess = true\r\n          console.log('Subscribe to topics res', res)\r\n        })\r\n      },\r\n      doUnSubscribe() {\r\n        const {\r\n          topic\r\n        } = this.subscription\r\n        this.client.unsubscribe(topic, error => {\r\n          if (error) {\r\n            console.log('Unsubscribe error', error)\r\n          }\r\n        })\r\n      },\r\n      doPublish() {\r\n        this.sending = true;\r\n        let obj = {\r\n          msg: this.publish.payload.msg,\r\n          id: \"111\",\r\n          msgType: this.publish.payload.msgType\r\n        }\r\n        const {\r\n          topic,\r\n          qos,\r\n          payload\r\n        } = this.publish\r\n        this.client.publish(topic, JSON.stringify(payload), {\r\n          qos,\r\n          retain: true\r\n        }, error => {\r\n          this.sending = false;\r\n          if (!error) {\r\n            this.receiveNews.push(obj);\r\n            this.inputVlaue = '';\r\n            this.scrollToBottom();\r\n          }\r\n        })\r\n      },\r\n      // 滚动到底部\r\n      scrollToBottom() {\r\n        let chat = this.$refs.chat;\r\n        chat.scrollTo({\r\n          top: chat.scrollHeight + 2000,\r\n          behavior: 'smooth'\r\n        });\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  ::-webkit-scrollbar {\r\n    width: 0rem;\r\n    height: 0.1rem;\r\n  }\r\n\r\n  .chatBox {\r\n    width: 600px;\r\n    height: 100%;\r\n    margin: 30px;\r\n    background-color: #eeeeee99;\r\n  }\r\n\r\n  .message {\r\n    height: calc(100% - 60px);\r\n    margin: 20px;\r\n    margin-bottom: 0;\r\n    overflow-y: scroll;\r\n  }\r\n\r\n  .messageItem {\r\n    display: flex;\r\n    margin-bottom: 15px;\r\n  }\r\n\r\n  .messageItem.self {\r\n    display: flex;\r\n    justify-content: end;\r\n    /* align-items: center; */\r\n  }\r\n\r\n  .messageItem .headIconLeft {\r\n    width: 50px;\r\n    height: 50px;\r\n    border-radius: 50%;\r\n    margin-left: 10px;\r\n  }\r\n\r\n  .messageItem .headIconRight {\r\n    width: 50px;\r\n    height: 50px;\r\n    border-radius: 50%;\r\n    margin-right: 10px;\r\n  }\r\n\r\n  .messageItem .text {\r\n    position: relative;\r\n    max-width: 400px;\r\n    overflow-wrap: break-word;\r\n    min-height: 30px;\r\n    line-height: 30px;\r\n    background-color: white;\r\n    padding: 10px;\r\n    border-radius: 6px;\r\n  }\r\n\r\n  .messageItem .imgMassage {\r\n    max-width: 400px;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .messageItem.other .text::before {\r\n    content: \"\";\r\n    background: url('../../assets/left.svg');\r\n    background-size: 20px 20px;\r\n    position: absolute;\r\n    left: -10px;\r\n    top: 15px;\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .messageItem.self .text {\r\n    position: relative;\r\n    background-color: #1afa29;\r\n    border-radius: 6px;\r\n  }\r\n\r\n  .messageItem.self .text::before {\r\n    content: \"\";\r\n    background: url('../../assets/right.svg');\r\n    background-size: 20px 20px;\r\n    position: absolute;\r\n    right: -10px;\r\n    top: 15px;\r\n    width: 20px;\r\n    height: 20px;\r\n  }\r\n\r\n  .send_input {\r\n    width: 100%;\r\n  }\r\n\r\n  .button {\r\n    position: absolute;\r\n    right: 30px;\r\n    bottom: 20px;\r\n    width: 100px;\r\n    height: 50px;\r\n  }\r\n</style>\n","import mod from \"-!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/@vue/cli-service/node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./mqtt.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/@vue/cli-service/node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./mqtt.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./mqtt.vue?vue&type=template&id=f0ce9982&scoped=true\"\nimport script from \"./mqtt.vue?vue&type=script&lang=js\"\nexport * from \"./mqtt.vue?vue&type=script&lang=js\"\nimport style0 from \"./mqtt.vue?vue&type=style&index=0&id=f0ce9982&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f0ce9982\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/@vue/cli-service/node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./mqtt.vue?vue&type=style&index=0&id=f0ce9982&prod&scoped=true&lang=css\""],"sourceRoot":""}